<?php

/**
 * Byblio.
 * partial view helper to format reset password 
 * @copyright 2013 Byblio.com
 * @author: Paul A. Oliver
 *
 */

	// escape if no form
	if(!$this->form){
		return;
	}
	
	// ref form
	$form = $this->form;
	
	// prepare
	$form->prepare();
	
	// ref input filter and validator
	$filter = $form->getInputFilter();
	
	// opening html
	$openStr = "<div class=\"resetPassword_form\">";
	$formOpenStr = $this->form()->openTag($form);
	
	// form name
	$formNameStr = $this->formRow($form->get('formname'));
	
	// csrf
	$csrfStr = $this->formRow($form->get('resetPasswordCsrf'));
	
	// email div
	$email = $filter->get('resetPassword-email');
	$currentValue = $email->getValue();
	
	if(!$currentValue){
		$emailValid = true;
	} else {
		$emailValid = $email->isValid();
	}
	
	if($emailValid){ // if valid email format
		
		// build div
		$emailStr = "<div class=\"row\"><div class=\"email\">"
				.$this->formRow($form->get('resetPassword-email'))
				."</div></div>";
	} else {
		// html
		$email = $form->get('resetPassword-email');
		$formInput = $this->formInput($email);
		// error message
		$errorMsg = $this->translate('Please enter a valid email address');
	
		// div
		$emailStr = "<div class=\"row\"><div class=\"email\">"
				.$formInput
				."<ul><li>" .$errorMsg ."</li></ul>"
						."</div></div>";
	}
	
	
	// submit div
	$submitStr = "<div class=\"row\"><div class=\"submit\">"
			.$this->formRow($form->get('resetPassword-submit'))
			."</div></div>";
	
	
	// close tag
	$formCloseStr = $this->form()->closeTag();
	
	// assemble
	$formStr = $openStr .$formOpenStr .$csrfStr .$formNameStr .$emailStr .$submitStr .$formCloseStr ."</div>";
	
	// echo
	echo $formStr;
	
?>